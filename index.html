<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Online Shopping Platform</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .search-filter {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 10px;
        }
        #search-bar, #category-filter {
            padding: 10px;
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .product-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .product-card img {
            max-width: 200px;
            max-height: 200px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        .product-card:hover {
            transform: scale(1.05);
        }
        .cart {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            min-width: 250px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .cart button {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #cart-items li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        #cart-items li button {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
        }
        #payment-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        #order-summary {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }


        .payment-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
        }
        .payment-content input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }


        #ordersummary{

            display: flex;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);

        }



        /* Add these styles */
.cart-summary {
    display: none; /* Hidden by default */
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* Center it */
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    min-width: 300px;
    max-width: 90%;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    z-index: 1000;
}

.cart-summary h2 {
    margin-top: 0;
}

.cart-summary ul {
    max-height: 200px;
    overflow-y: auto;
    list-style: none;
    padding: 0;
    margin: 10px 0;
}

/* Backdrop for the modal */
.modal-backdrop {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
    z-index: 999;
}

        

/* Login */

#login-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

#login-modal .payment-content {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    width: 80%;
    max-width: 400px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}









    </style>
</head>
<body>
    <h1>Online Shopping Platform</h1>
    
    

    <div class="search-filter">
        <input type="text" id="search-bar" placeholder="Search products...">
        <select id="category-filter">
            <option value="">All Categories</option>
            <option value="Electronics">Electronics</option>
            <option value="Clothing">Clothing</option>
            <option value="Books">Books</option>
        </select>
    
    </div>
    
    <div id="product-catalog" class="product-grid"></div>
    



    <!-- Shopping Cart item -->
    <div id="cart" class="cart">
        <h2>Shopping Cart</h2>
        <ul id="cart-items-main"></ul>
        <p>Total Discount: $<span id="cart-discount-main">0.00</span></p>
        <p>Total: $<span id="cart-total-main">0.00</span></p>
        <!-- <button onclick="PaymentMethod()">Checkout</button> -->
        <button onclick="checkout()">Checkout Tunay na button</button>
    </div>
    
    <div id="cart-summary-modal">
        <div class="modal-backdrop" id="cart-summary-backdrop"></div>
        <div id="cart-summary" class="cart-summary">
            <h2>Order Summary</h2>
            <ul id="cart-items-summary"></ul>
            <p>Total Discount: $<span id="cart-discount-summary">0.00</span></p>
            <p>Total: $<span id="cart-total-summary">0.00</span></p>
            <button onclick="redirectToSignIn()">Sign-In To Checkout</button>
            <button onclick="closeCartSummary()">Close</button>
        </div>
    </div>
    
    

<!-- Eto yung Order Summary, need me i change yung button ng checkout -->
   



    <div id="payment-modal" class="payment-modal">
        <div class="payment-content">
            <h2>Payment Details</h2>
            <div>Select Payment Method</div>
            <select id="payment-method" onchange="togglePaymentFields()">
                <option value="">Select Payment Method</option>
                <option value="cash">Cash</option>
                <option value="card">Credit Card</option>
            </select>
            <div id="common-fields" style="display:none;">
                <div>Enter Full Name:</div>
                <input type="text" id="customer-name" placeholder="Full Name" required>
                <div>Enter phone number</div>
                <input type="tel" id="customer-phone" placeholder="Phone Number" required>
                <div>Enter Address</div>
                <input type="text" id="customer-address" placeholder="Delivery Address" required>
            </div>
            <div id="card-fields" style="display:none;">
                <div>Enter Card Number</div>
                <input type="text" id="card-number" placeholder="Card Number" required>
                <div>Enter card expiry date</div>
                <input type="text" id="card-expiry" placeholder="Expiry Date (MM/YY)" required>
                <div>Enter CCV</div>
                <input type="text" id="card-cvv" placeholder="CVV" required>
            </div>
            <button onclick="processPayment(); ClosePaymentModalFromLogin()" >Complete Payment</button>
            <button onclick="closePaymentModal()">Cancel</button>
        </div>
    </div>

    <script>
        // MAIN CLASS
        class Product {
            constructor(id, name, price, category, imageUrl) {
                this.id = id;
                this.name = name;
                this.price = price;
                this.category = category;
                this.imageUrl = imageUrl;
            }

            applyDiscount() {
                return this.price;
            }
        }

        class Electronics extends Product {
            applyDiscount() {

                return this.price * 0.90; //10% Discount
            }
        }

        class Clothing extends Product {
            applyDiscount() {
                return this.price * 0.85; // 15% off
            }
        }
        class Books extends Product {
            applyDiscount() {
                return this.price * 0.95; // 5% off
            }
        }

        // Cart Class 
//         class Cart {
//             constructor() {
//                 this.items = [];
//             }

//             addItem(product) {
//                 const existingItem = this.items.find(item => item.id === product.id);
                
//                 if (existingItem) {
//                     existingItem.quantity++;
//                 } else {
//                     const cartItem = Object.create(Object.getPrototypeOf(product));
//                     Object.assign(cartItem, product);
//                     cartItem.quantity = 1;
//                     cartItem.uniqueId = Date.now();
//                     this.items.push(cartItem);
//                 }
                
//                 this.updateCart();
//             }

//             removeItem(uniqueId) {
//                 const index = this.items.findIndex(item => item.uniqueId === uniqueId);
                
//                 if (index !== -1) {
//                     if (this.items[index].quantity > 1) {
//                         this.items[index].quantity--;
//                     } else {
//                         this.items.splice(index, 1);
//                     }
                    
//                     this.updateCart();
//                 }
//             }

//             calculateTotal() {
//                 return this.items.reduce((total, item) => 
//                     total + (item.applyDiscount() * item.quantity), 0
//                 ).toFixed(2);
//             }

//             calculateDisount(){

//                 return this.items.reduce((total, item) => 
//                 total + ((item.price - item.applyDiscount()) * item.quantity), 0
//                 ).toFixed(2);


//             }

//             // updateCart() {
//             //     const cartItems = document.getElementById('cart-items');
//             //     const cartTotal = document.getElementById('cart-total');
//             //     const cartDisount = document.getElementById('cart-discount')
                
//             //     cartItems.innerHTML = '';
//             //     this.items.forEach(item => {
//             //         const li = document.createElement('li');
//             //         li.innerHTML = `
//             //             <span>${item.name} x${item.quantity} - $${(item.applyDiscount() * item.quantity).toFixed(2)}</span>
//             //             <button onclick="cart.removeItem(${item.uniqueId})">Remove</button>
//             //         `;
//             //         cartItems.appendChild(li);
//             //     });

//             //     cartTotal.textContent = this.calculateTotal();
//             //     cartDisount.textContent = this.calculateDisount();
                
//             // }

// updateCart() {
//     const cartItemsMain = document.getElementById('cart-items-main');
//     const cartItemsSummary = document.getElementById('cart-items-summary');
//     const cartTotalMain = document.getElementById('cart-total-main');
//     const cartTotalSummary = document.getElementById('cart-total-summary');
//     const cartDiscountMain = document.getElementById('cart-discount-main');
//     const cartDiscountSummary = document.getElementById('cart-discount-summary');

//     // Clear both lists
//     cartItemsMain.innerHTML = '';
//     cartItemsSummary.innerHTML = '';

//     // Populate items for both displays
//     this.items.forEach(item => {
//         const li = document.createElement('li');
//         li.innerHTML = `
//             <span>${item.name} x${item.quantity} - $${(item.applyDiscount() * item.quantity).toFixed(2)}</span>
//             <button onclick="cart.removeItem(${item.uniqueId})">Remove</button>
//         `;
//         cartItemsMain.appendChild(li);
//         cartItemsSummary.appendChild(li.cloneNode(true));
//     });

//     // Update totals and discounts for both
//     const total = this.calculateTotal();
//     const discount = this.calculateDisount();

//     cartTotalMain.textContent = total;
//     cartTotalSummary.textContent = total;
//     cartDiscountMain.textContent = discount;
//     cartDiscountSummary.textContent = discount;
// }


class Cart {
    constructor() {
        this.items = this.loadCart();
    }

    loadCart() {
        const savedCart = localStorage.getItem('cartItems');
        if (savedCart) {
            const parsedCart = JSON.parse(savedCart);
            return parsedCart.map(item => {
                let product;
                switch(item.category) {
                    case 'Electronics':
                        product = new Electronics(item.id, item.name, item.price, item.category, item.imageUrl);
                        break;
                    case 'Clothing':
                        product = new Clothing(item.id, item.name, item.price, item.category, item.imageUrl);
                        break;
                    case 'Books':
                        product = new Books(item.id, item.name, item.price, item.category, item.imageUrl);
                        break;
                }
                product.quantity = item.quantity;
                product.uniqueId = item.uniqueId;
                return product;
            });
        }
        return [];
    }

    saveCart() {
        localStorage.setItem('cartItems', JSON.stringify(this.items));
    }

    addItem(product) {
        const existingItem = this.items.find(item => item.id === product.id);
        
        if (existingItem) {
            existingItem.quantity++;
        } else {
            const cartItem = Object.create(Object.getPrototypeOf(product));
            Object.assign(cartItem, product);
            cartItem.quantity = 1;
            cartItem.uniqueId = Date.now();
            this.items.push(cartItem);
        }
        
        this.saveCart();
        this.updateCart();
    }

    removeItem(uniqueId) {
        const index = this.items.findIndex(item => item.uniqueId === uniqueId);
        
        if (index !== -1) {
            if (this.items[index].quantity > 1) {
                this.items[index].quantity--;
            } else {
                this.items.splice(index, 1);
            }
            
            this.saveCart();
            this.updateCart();
        }
    }

    calculateTotal() {
        return this.items.reduce((total, item) => 
            total + (item.applyDiscount() * item.quantity), 0
        ).toFixed(2);
    }

    calculateDisount() {
        return this.items.reduce((total, item) => 
            total + ((item.price - item.applyDiscount()) * item.quantity), 0
        ).toFixed(2);
    }

    updateCart() {
        const cartItemsMain = document.getElementById('cart-items-main');
        const cartItemsSummary = document.getElementById('cart-items-summary');
        const cartTotalMain = document.getElementById('cart-total-main');
        const cartTotalSummary = document.getElementById('cart-total-summary');
        const cartDiscountMain = document.getElementById('cart-discount-main');
        const cartDiscountSummary = document.getElementById('cart-discount-summary');

        cartItemsMain.innerHTML = '';
        cartItemsSummary.innerHTML = '';

        this.items.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${item.name} x${item.quantity} - $${(item.applyDiscount() * item.quantity).toFixed(2)}</span>
                <button onclick="cart.removeItem(${item.uniqueId})">Remove</button>
            `;
            cartItemsMain.appendChild(li);
            cartItemsSummary.appendChild(li.cloneNode(true));
        });

        const total = this.calculateTotal();
        const discount = this.calculateDisount();

        cartTotalMain.textContent = total;
        cartTotalSummary.textContent = total;
        cartDiscountMain.textContent = discount;
        cartDiscountSummary.textContent = discount;
    }
}










//         }

        // Product Catalog items
        const products = [
            new Electronics(1, 'Smartphone', 599.99, 'Electronics', './Smart Phone.png'),
            new Electronics(2, 'Laptop', 1299.99, 'Electronics', 'Laptop.png'),
            new Clothing(3, 'T-Shirt', 29.99, 'Clothing', 'T-shirt.png'),
            new Clothing(4, 'Jeans', 59.99, 'Clothing', 'Jeans.png'),
            new Books(5, 'Programming Book', 49.99, 'Books', 'Textbook.png'),
            new Books(6, 'Science Fiction Novel', 19.99, 'Books', 'Novel.png')
        ];

        // Render Product Catalog with Search and Filter
        function renderProducts(searchTerm = '', categoryFilter = '') {
            const productCatalog = document.getElementById('product-catalog');
            productCatalog.innerHTML = '';

            const filteredProducts = products.filter(product => 
                (searchTerm === '' || product.name.toLowerCase().includes(searchTerm.toLowerCase())) &&
                (categoryFilter === '' || product.category === categoryFilter)
            );

            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                productCard.innerHTML = `
                    <img src="${product.imageUrl}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <p>Category: ${product.category}</p>
                    <p>Original Price: $${product.price.toFixed(2)}</p>
                    <p>Discounted Price: $${product.applyDiscount().toFixed(2)}</p>
                    <button onclick="cart.addItem(products[${product.id - 1}])">Add to Cart</button>
                `;
                productCatalog.appendChild(productCard);
            });
        }

        // Payment Modal Functions
        function checkout() {
            if (cart.items.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            document.getElementById('cart-summary').style.display = 'block';


            // document.getElementById('payment-modal').style.display = 'block';
                // Eto yung gagawin mo after ng login

        }

        function PaymentMethod() {
            if (cart.items.length === 0) {
                alert('Your cart is empty!');
                return;
            }
          

            document.getElementById('payment-modal').style.display = 'block';
                // Eto yung gagawin mo after ng login

        }
//Palit yung payment-modal to order-summary

        function OrderSummary() {
            
            document.getElementById('order-summary').style.display = 'block';
        }





        function togglePaymentFields() {
            const paymentMethod = document.getElementById('payment-method').value;
            const commonFields = document.getElementById('common-fields');
            const cardFields = document.getElementById('card-fields');

            commonFields.style.display = paymentMethod ? 'block' : 'none';
            cardFields.style.display = paymentMethod === 'card' ? 'block' : 'none';
        }

        function closePaymentModal() {
            document.getElementById('payment-modal').style.display = 'none';
        }

        function processPayment() {
            const paymentMethod = document.getElementById('payment-method').value;
            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const address = document.getElementById('customer-address').value;

            // Validation
            if (!name || !phone || !address) {
                alert('Please fill in all required fields');
                return;
            }

            if (paymentMethod === 'card') {
                const cardNumber = document.getElementById('card-number').value;
                const cardExpiry = document.getElementById('card-expiry').value;
                const cardCVV = document.getElementById('card-cvv').value;

                if (!cardNumber || !cardExpiry || !cardCVV) {
                    alert('Please fill in all card details');
                    return;
                }
            }

            // Payment processing logic
            const total = cart.calculateTotal();
            alert(`Order Completed!\nTotal: $${total}\nPayment Method: ${paymentMethod.toUpperCase()}`);
            window.location.href = "http://127.0.0.1:5500/index.html";
            // Reset cart and modal
            ///testing push
            cart.items = [];
            cart.updateCart();
            closePaymentModal();
            
            
        }

        // Initial render and event listeners
        renderProducts();

        document.getElementById('search-bar').addEventListener('input', function() {
            const searchTerm = this.value;
            const categoryFilter = document.getElementById('category-filter').value;
            renderProducts(searchTerm, categoryFilter);
        });

        document.getElementById('category-filter').addEventListener('change', function() {
            const searchTerm = document.getElementById('search-bar').value;
            const categoryFilter = this.value;
            renderProducts(searchTerm, categoryFilter);
        });

        // Initialize Cart
        const cart = new Cart();



    
        function openCartSummary() {
    document.getElementById('cart-summary').style.display = 'block';
    document.getElementById('cart-summary-backdrop').style.display = 'block';
}

function closeCartSummary() {
    document.getElementById('cart-summary').style.display = 'none';
    document.getElementById('cart-summary-backdrop').style.display = 'none';
}


// Redirect to login.html
function redirectToSignIn() {
    window.location.href = 'login.html'; // Replace 'login.html' with the path to your login page.
}





// On load show the payment method

function openCheckoutModal() {
        const modal = document.getElementById('payment-modal');
        modal.style.display = 'block'; // Ensure your modal uses display to show/hide
    }

    function checkForCheckoutParameter() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('checkout') === 'true') {
            openCheckoutModal();
        }
    }

    // Run this function when the page loads
    window.onload = checkForCheckoutParameter;



    function ClosePaymentModalFromLogin() {
        const modal = document.getElementById('payment-modal');
        modal.style.display = 'none'; // Ensure your modal uses display to show/hide
    }




    function redirectToSignIn() {
    document.getElementById('login-modal').style.display = 'block';
    closeCartSummary();
}

function closeLoginModal() {
    document.getElementById('login-modal').style.display = 'none';
}

function handleLogin() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    if (!username || !password) {
        alert('Please enter both username and password');
        return;
    }
    
    // Add your login validation logic here
    // For demo, using simple check
    if (username === 'demo' && password === 'password') {
        closeLoginModal();
        PaymentMethod();
    } else {
        alert('Invalid credentials');
    }
}
    </script>
</body>

<div id="login-modal" class="payment-modal">
    <div class="payment-content">
        <h2>Login</h2>
        <div id="login-fields">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button onclick="handleLogin()">Login</button>
            <button onclick="closeLoginModal()">Cancel</button>
        </div>
    </div>
</div>
</html>